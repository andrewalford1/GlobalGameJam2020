<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Ast√©ria</title>
    <link rel="stylesheet" content="text/css" href="style/fullscreen.css">
    <script src="./js/lib/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

const WIDTH = window.innerWidth;
const HEIGHT = window.innerHeight;

var config = {
    type: Phaser.AUTO,
    width: WIDTH,
    height:HEIGHT,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);

var player;
var platforms;
var cursors;
var bad;
var canDoubleJump = false

function preload ()
{
   this.load.image('bg', 'assets/img/Background.png');
   this.load.image('player', 'assets/img/star.png');
   this.load.image('platform', 'assets/img/platform.png');
    this.load.image('column', 'assets/img/Column 1.png');
    this.load.image('cloud', 'assets/img/Cloud1.png');
    this.load.image('grass', 'assets/img/Platform1.png');
   this.load.image('bomb', 'assets/img/bomb.png');
    this.load.spritesheet('urania', 'assets/img/Characters/Urania/UraniaSprites3.png', {frameWidth: 76, frameHeight: 87});
    this.load.spritesheet('urania float', 'assets/img/Characters/Urania/UraniaSprites Float1.png', {frameWidth: 76, frameHeight: 87});
}

function create ()
{
    //bg and platform setup
    background = this.add.image(0, 0, 'bg').setOrigin(0,0);
    background.setScrollFactor(0);

    platforms = this.physics.add.staticGroup();
    const ground = platforms.create(400, HEIGHT-30, 'platform').setScale(10, 2).refreshBody();
    platforms.create(WIDTH-1000, HEIGHT-200, 'cloud').setScale(0.2, 0.2).refreshBody();
    platforms.create(WIDTH-300, HEIGHT-300, 'grass').setScale(0.2, 0.2).refreshBody();
    platforms.create(WIDTH-500, HEIGHT-100, 'column').setScale(0.2, 0.2).refreshBody();

    //player setup
    player = this.physics.add.sprite(100, 450, 'urania');
    player.setScale(1.5);
    player.setBounce(0.1);
    player.setCollideWorldBounds(false);
    player.setDrag(30);
    player.setMaxVelocity(300, 1000);
    this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('urania', {start: 0, end: 3}),
        frameRate: 10,
        repeat: -1
    });
    this.anims.create({
        key: 'float left',
        frames: this.anims.generateFrameNumbers('urania float', {start: 0, end: 1}),
        frameRate: 10,
        repeat: -1
    });
    this.anims.create({
        key: 'float right',
        frames: this.anims.generateFrameNumbers('urania float', {start: 2, end: 3}),
        frameRate: 10,
        repeat: -1
    });
    this.anims.create({
        key: 'turn',
        frames: [ { key: 'urania', frame: 4}],
        frameRate: 20
    });
    this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('urania', {start: 6, end: 9 }),
        frameRate: 10,
        repeat: -1
    });

    //whataver kills the player things
    bad = this.physics.add.staticGroup();
    bad.create(300, HEIGHT-70, 'bomb').setScale(2);

    //colliders
    this.physics.add.collider(player, platforms);   
    this.physics.add.collider(player, bad, playerHit, null, this);

    //keys
    cursors = this.input.keyboard.createCursorKeys();
    this.input.keyboard.on('keydown_UP', function(event) {
        jump()
    });
    this.input.keyboard.on('keydown_DOWN', function(event) {
        pound()
    });

    //camera
    this.cameras.main.setBounds(0,0, 1000000000000000000000000000000, 600);
    this.cameras.main.startFollow(player);
} 

function update ()
{

    if (cursors.left.isDown)
    {
        if (player.body.touching.down)
            {
                player.setAccelerationX(-500);
            } else {
                player.setAccelerationX(-200);
            }
        player.anims.play('left', true);
    }
    else if (cursors.right.isDown)
    {
        if (player.body.touching.down)
            {
                player.setAccelerationX(500);
            } else {
                player.setAccelerationX(200);
            }
        player.anims.play('right', true);
    }
    else
    {
        if (player.body.touching.down)
            {
                player.setAccelerationX(0);
                player.anims.play('turn');
            }
        else 
            {
                if (player.body.velocity.x < 0)
                    {
                        player.anims.play('float left', true); 
                    }
               else 
                   {
                        player.anims.play('float right', true);
                   }
            }
    }
    
    if (player.body.touching.down)
        {
            player.setDragX(1500);
            // canDoubleJump = true
        } else {
            player.setDragX(1000);
        }

    if (!cursors.up.isDown && !cursors.down.isDown)
    {
        player.setGravityY(0);
    }
    
}

function jump ()
    {
        if (player.body.touching.down)
            {
                player.setVelocityY(-330);
            } else if (canDoubleJump) {
                player.setVelocityY(-330);
                canDoubleJump = false
            } else {
                player.setGravityY(-250)
            }
    }
    
function pound ()
    {
        if (player.body.touching.down)
            {
                player.setDragX(2000);
            } else {
                player.setVelocityY(750);
            }
    }
    
function playerHit(player, spike) {
    player.setVelocity(0,0);
    player.setX(50);
    player.setY(300);
}


</script>

</body>
</html>
